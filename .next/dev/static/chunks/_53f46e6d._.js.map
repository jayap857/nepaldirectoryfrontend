{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/acer/OneDrive/Desktop/nepaldirectoryfrontend/services/api.js"],"sourcesContent":["import axios from \"axios\";\r\n\r\n// Create Axios instance\r\nconst api = axios.create({\r\n  baseURL: process.env.NEXT_PUBLIC_API_BASE_URL, // reads from .env.local\r\n});\r\n\r\n// Add a request interceptor to attach JWT token if available\r\napi.interceptors.request.use((config) => {\r\n  if (typeof window !== \"undefined\") {\r\n    const token = localStorage.getItem(\r\n      process.env.NEXT_PUBLIC_JWT_STORAGE_KEY\r\n    );\r\n    if (token) {\r\n      config.headers.Authorization = `Bearer ${token}`;\r\n    }\r\n  }\r\n  return config;\r\n});\r\n\r\nexport default api;\r\n"],"names":[],"mappings":";;;;AAIW;AAJX;;AAEA,wBAAwB;AACxB,MAAM,MAAM,mJAAK,CAAC,MAAM,CAAC;IACvB,OAAO;AACT;AAEA,6DAA6D;AAC7D,IAAI,YAAY,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;IAC5B,wCAAmC;QACjC,MAAM,QAAQ,aAAa,OAAO;QAGlC,IAAI,OAAO;YACT,OAAO,OAAO,CAAC,aAAa,GAAG,CAAC,OAAO,EAAE,OAAO;QAClD;IACF;IACA,OAAO;AACT;uCAEe","debugId":null}},
    {"offset": {"line": 33, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/acer/OneDrive/Desktop/nepaldirectoryfrontend/services/authService.js"],"sourcesContent":["import api from \"./api\";\r\n\r\n// Login function - FIXED to use /api/token/\r\nconst login = async (email, password) => {\r\n  try {\r\n    // Django JWT expects 'username' field, but you might use email as username\r\n    // Adjust based on your Django User model (email vs username)\r\n    const response = await api.post(\"/token/\", { \r\n      username: email,  // or email: email if your backend accepts email\r\n      password \r\n    });\r\n    \r\n    // Django JWT returns { access, refresh }\r\n    return {\r\n      token: response.data.access,\r\n      refresh: response.data.refresh\r\n    };\r\n  } catch (error) {\r\n    throw error.response?.data || { message: \"Login failed\" };\r\n  }\r\n};\r\n\r\n// Signup function\r\nconst signup = async (signupData) => {\r\n  try {\r\n    // Backend expects: username, email, password, password_confirm, phone_number (optional)\r\n    const response = await api.post(\"/register/\", {\r\n      username: signupData.username,\r\n      email: signupData.email,\r\n      password: signupData.password,\r\n      password_confirm: signupData.password_confirm,\r\n      phone_number: signupData.phone_number || \"\"\r\n    });\r\n    return response.data;\r\n  } catch (error) {\r\n    throw error.response?.data || { message: \"Signup failed\" };\r\n  }\r\n};\r\n\r\n// Get user profile (JWT automatically attached via interceptor)\r\nconst getProfile = async () => {\r\n  try {\r\n    const response = await api.get(\"/profile/\");\r\n    // Backend returns full UserProfileSerializer\r\n    return response.data;\r\n  } catch (error) {\r\n    throw error.response?.data || { message: \"Failed to fetch profile\" };\r\n  }\r\n};\r\n\r\n// Get user dashboard data\r\nconst getDashboard = async () => {\r\n  try {\r\n    const response = await api.get(\"/dashboard/\");\r\n    return response.data;\r\n  } catch (error) {\r\n    throw error.response?.data || { message: \"Failed to fetch dashboard\" };\r\n  }\r\n};\r\n\r\n// Refresh token\r\nconst refreshToken = async () => {\r\n  try {\r\n    const refresh = localStorage.getItem(\r\n      process.env.NEXT_PUBLIC_JWT_REFRESH_KEY || \"refresh_token\"\r\n    );\r\n    \r\n    if (!refresh) {\r\n      throw new Error(\"No refresh token available\");\r\n    }\r\n\r\n    const response = await api.post(\"/token/refresh/\", { refresh });\r\n    const newAccessToken = response.data.access;\r\n    \r\n    // Update access token in storage\r\n    localStorage.setItem(\r\n      process.env.NEXT_PUBLIC_JWT_STORAGE_KEY,\r\n      newAccessToken\r\n    );\r\n    \r\n    return newAccessToken;\r\n  } catch (error) {\r\n    // If refresh fails, clear tokens and logout\r\n    logout();\r\n    throw error.response?.data || { message: \"Session expired\" };\r\n  }\r\n};\r\n\r\n// Logout\r\nconst logout = () => {\r\n  localStorage.removeItem(process.env.NEXT_PUBLIC_JWT_STORAGE_KEY);\r\n  localStorage.removeItem(process.env.NEXT_PUBLIC_JWT_REFRESH_KEY || \"refresh_token\");\r\n};\r\n\r\nexport default {\r\n  login,\r\n  signup,\r\n  getProfile,\r\n  getDashboard,\r\n  refreshToken,\r\n  logout,\r\n};"],"names":[],"mappings":";;;;AAgEM;AAhEN;;AAEA,4CAA4C;AAC5C,MAAM,QAAQ,OAAO,OAAO;IAC1B,IAAI;QACF,2EAA2E;QAC3E,6DAA6D;QAC7D,MAAM,WAAW,MAAM,6HAAG,CAAC,IAAI,CAAC,WAAW;YACzC,UAAU;YACV;QACF;QAEA,yCAAyC;QACzC,OAAO;YACL,OAAO,SAAS,IAAI,CAAC,MAAM;YAC3B,SAAS,SAAS,IAAI,CAAC,OAAO;QAChC;IACF,EAAE,OAAO,OAAO;QACd,MAAM,MAAM,QAAQ,EAAE,QAAQ;YAAE,SAAS;QAAe;IAC1D;AACF;AAEA,kBAAkB;AAClB,MAAM,SAAS,OAAO;IACpB,IAAI;QACF,wFAAwF;QACxF,MAAM,WAAW,MAAM,6HAAG,CAAC,IAAI,CAAC,cAAc;YAC5C,UAAU,WAAW,QAAQ;YAC7B,OAAO,WAAW,KAAK;YACvB,UAAU,WAAW,QAAQ;YAC7B,kBAAkB,WAAW,gBAAgB;YAC7C,cAAc,WAAW,YAAY,IAAI;QAC3C;QACA,OAAO,SAAS,IAAI;IACtB,EAAE,OAAO,OAAO;QACd,MAAM,MAAM,QAAQ,EAAE,QAAQ;YAAE,SAAS;QAAgB;IAC3D;AACF;AAEA,gEAAgE;AAChE,MAAM,aAAa;IACjB,IAAI;QACF,MAAM,WAAW,MAAM,6HAAG,CAAC,GAAG,CAAC;QAC/B,6CAA6C;QAC7C,OAAO,SAAS,IAAI;IACtB,EAAE,OAAO,OAAO;QACd,MAAM,MAAM,QAAQ,EAAE,QAAQ;YAAE,SAAS;QAA0B;IACrE;AACF;AAEA,0BAA0B;AAC1B,MAAM,eAAe;IACnB,IAAI;QACF,MAAM,WAAW,MAAM,6HAAG,CAAC,GAAG,CAAC;QAC/B,OAAO,SAAS,IAAI;IACtB,EAAE,OAAO,OAAO;QACd,MAAM,MAAM,QAAQ,EAAE,QAAQ;YAAE,SAAS;QAA4B;IACvE;AACF;AAEA,gBAAgB;AAChB,MAAM,eAAe;IACnB,IAAI;QACF,MAAM,UAAU,aAAa,OAAO,CAClC,qDAA2C;QAG7C,IAAI,CAAC,SAAS;YACZ,MAAM,IAAI,MAAM;QAClB;QAEA,MAAM,WAAW,MAAM,6HAAG,CAAC,IAAI,CAAC,mBAAmB;YAAE;QAAQ;QAC7D,MAAM,iBAAiB,SAAS,IAAI,CAAC,MAAM;QAE3C,iCAAiC;QACjC,aAAa,OAAO,mDAElB;QAGF,OAAO;IACT,EAAE,OAAO,OAAO;QACd,4CAA4C;QAC5C;QACA,MAAM,MAAM,QAAQ,EAAE,QAAQ;YAAE,SAAS;QAAkB;IAC7D;AACF;AAEA,SAAS;AACT,MAAM,SAAS;IACb,aAAa,UAAU;IACvB,aAAa,UAAU,CAAC,qDAA2C;AACrE;uCAEe;IACb;IACA;IACA;IACA;IACA;IACA;AACF","debugId":null}},
    {"offset": {"line": 143, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/acer/OneDrive/Desktop/nepaldirectoryfrontend/contexts/AuthContext.js"],"sourcesContent":["\"use client\";\r\n\r\nimport { createContext, useState, useEffect } from \"react\";\r\nimport authService from \"../services/authService\";\r\n\r\n// Create context\r\nexport const AuthContext = createContext();\r\n\r\n// Context provider\r\nexport const AuthProvider = ({ children }) => {\r\n  const [user, setUser] = useState(null);\r\n  const [isAuthenticated, setIsAuthenticated] = useState(false);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  // Load user on app start\r\n  useEffect(() => {\r\n    const token = localStorage.getItem(\r\n      process.env.NEXT_PUBLIC_JWT_STORAGE_KEY\r\n    );\r\n    \r\n    if (token) {\r\n      authService\r\n        .getProfile()\r\n        .then((res) => {\r\n          setUser(res);\r\n          setIsAuthenticated(true);\r\n        })\r\n        .catch(() => {\r\n          // Try to refresh token\r\n          authService\r\n            .refreshToken()\r\n            .then(() => {\r\n              // Retry getting profile after refresh\r\n              return authService.getProfile();\r\n            })\r\n            .then((res) => {\r\n              setUser(res);\r\n              setIsAuthenticated(true);\r\n            })\r\n            .catch(() => {\r\n              // If refresh also fails, clear everything\r\n              localStorage.removeItem(process.env.NEXT_PUBLIC_JWT_STORAGE_KEY);\r\n              localStorage.removeItem(process.env.NEXT_PUBLIC_JWT_REFRESH_KEY || \"refresh_token\");\r\n              setUser(null);\r\n              setIsAuthenticated(false);\r\n            });\r\n        })\r\n        .finally(() => setLoading(false));\r\n    } else {\r\n      setLoading(false);\r\n    }\r\n  }, []);\r\n\r\n  // Login\r\n  const login = async (email, password) => {\r\n    try {\r\n      const res = await authService.login(email, password);\r\n      const { token, refresh } = res;\r\n      \r\n      // Store both tokens\r\n      localStorage.setItem(process.env.NEXT_PUBLIC_JWT_STORAGE_KEY, token);\r\n      localStorage.setItem(\r\n        process.env.NEXT_PUBLIC_JWT_REFRESH_KEY || \"refresh_token\",\r\n        refresh\r\n      );\r\n\r\n      // Fetch user info\r\n      const userInfo = await authService.getProfile();\r\n      setUser(userInfo);\r\n      setIsAuthenticated(true);\r\n\r\n      return { success: true };\r\n    } catch (err) {\r\n      console.error(\"Login error:\", err);\r\n      return { \r\n        success: false, \r\n        message: err.detail || err.message || \"Login failed\" \r\n      };\r\n    }\r\n  };\r\n\r\n  // Signup\r\n  const signup = async (userData) => {\r\n    try {\r\n      await authService.signup(userData);\r\n      return { success: true };\r\n    } catch (err) {\r\n      console.error(\"Signup error:\", err);\r\n      \r\n      // Django returns validation errors as objects\r\n      let errorMessage = \"Signup failed\";\r\n      \r\n      if (typeof err === 'object') {\r\n        // Extract first error message\r\n        const firstError = Object.values(err)[0];\r\n        if (Array.isArray(firstError)) {\r\n          errorMessage = firstError[0];\r\n        } else if (typeof firstError === 'string') {\r\n          errorMessage = firstError;\r\n        }\r\n      } else if (err.message) {\r\n        errorMessage = err.message;\r\n      }\r\n      \r\n      return { success: false, message: errorMessage };\r\n    }\r\n  };\r\n\r\n  // Logout\r\n  const logout = () => {\r\n    authService.logout();\r\n    setUser(null);\r\n    setIsAuthenticated(false);\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider\r\n      value={{\r\n        user,\r\n        isAuthenticated,\r\n        login,\r\n        logout,\r\n        signup,\r\n        loading,\r\n      }}\r\n    >\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n};"],"names":[],"mappings":";;;;;;AAiBM;;AAfN;AACA;;;AAHA;;;AAMO,MAAM,4BAAc,IAAA,8KAAa;AAGjC,MAAM,eAAe,CAAC,EAAE,QAAQ,EAAE;;IACvC,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,yKAAQ,EAAC;IACjC,MAAM,CAAC,iBAAiB,mBAAmB,GAAG,IAAA,yKAAQ,EAAC;IACvD,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,yKAAQ,EAAC;IAEvC,yBAAyB;IACzB,IAAA,0KAAS;kCAAC;YACR,MAAM,QAAQ,aAAa,OAAO;YAIlC,IAAI,OAAO;gBACT,qIAAW,CACR,UAAU,GACV,IAAI;8CAAC,CAAC;wBACL,QAAQ;wBACR,mBAAmB;oBACrB;6CACC,KAAK;8CAAC;wBACL,uBAAuB;wBACvB,qIAAW,CACR,YAAY,GACZ,IAAI;sDAAC;gCACJ,sCAAsC;gCACtC,OAAO,qIAAW,CAAC,UAAU;4BAC/B;qDACC,IAAI;sDAAC,CAAC;gCACL,QAAQ;gCACR,mBAAmB;4BACrB;qDACC,KAAK;sDAAC;gCACL,0CAA0C;gCAC1C,aAAa,UAAU;gCACvB,aAAa,UAAU,CAAC,qDAA2C;gCACnE,QAAQ;gCACR,mBAAmB;4BACrB;;oBACJ;6CACC,OAAO;8CAAC,IAAM,WAAW;;YAC9B,OAAO;gBACL,WAAW;YACb;QACF;iCAAG,EAAE;IAEL,QAAQ;IACR,MAAM,QAAQ,OAAO,OAAO;QAC1B,IAAI;YACF,MAAM,MAAM,MAAM,qIAAW,CAAC,KAAK,CAAC,OAAO;YAC3C,MAAM,EAAE,KAAK,EAAE,OAAO,EAAE,GAAG;YAE3B,oBAAoB;YACpB,aAAa,OAAO,mDAA0C;YAC9D,aAAa,OAAO,CAClB,qDAA2C,iBAC3C;YAGF,kBAAkB;YAClB,MAAM,WAAW,MAAM,qIAAW,CAAC,UAAU;YAC7C,QAAQ;YACR,mBAAmB;YAEnB,OAAO;gBAAE,SAAS;YAAK;QACzB,EAAE,OAAO,KAAK;YACZ,QAAQ,KAAK,CAAC,gBAAgB;YAC9B,OAAO;gBACL,SAAS;gBACT,SAAS,IAAI,MAAM,IAAI,IAAI,OAAO,IAAI;YACxC;QACF;IACF;IAEA,SAAS;IACT,MAAM,SAAS,OAAO;QACpB,IAAI;YACF,MAAM,qIAAW,CAAC,MAAM,CAAC;YACzB,OAAO;gBAAE,SAAS;YAAK;QACzB,EAAE,OAAO,KAAK;YACZ,QAAQ,KAAK,CAAC,iBAAiB;YAE/B,8CAA8C;YAC9C,IAAI,eAAe;YAEnB,IAAI,OAAO,QAAQ,UAAU;gBAC3B,8BAA8B;gBAC9B,MAAM,aAAa,OAAO,MAAM,CAAC,IAAI,CAAC,EAAE;gBACxC,IAAI,MAAM,OAAO,CAAC,aAAa;oBAC7B,eAAe,UAAU,CAAC,EAAE;gBAC9B,OAAO,IAAI,OAAO,eAAe,UAAU;oBACzC,eAAe;gBACjB;YACF,OAAO,IAAI,IAAI,OAAO,EAAE;gBACtB,eAAe,IAAI,OAAO;YAC5B;YAEA,OAAO;gBAAE,SAAS;gBAAO,SAAS;YAAa;QACjD;IACF;IAEA,SAAS;IACT,MAAM,SAAS;QACb,qIAAW,CAAC,MAAM;QAClB,QAAQ;QACR,mBAAmB;IACrB;IAEA,qBACE,6LAAC,YAAY,QAAQ;QACnB,OAAO;YACL;YACA;YACA;YACA;YACA;YACA;QACF;kBAEC;;;;;;AAGP;GAxHa;KAAA","debugId":null}}]
}